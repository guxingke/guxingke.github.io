<!doctype html>
<html lang="en">
    <head>
        <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
        <meta content="text/html; charset=utf-8" http-equiv="content-type"/>
        <meta content="width=device-width, initial-scale=1" name="viewport"/>

        
        <meta name="robots" content="index,follow">
        <meta name="googlebot" content="index,follow">

        <meta name="google" content="nositelinkssearchbox">
        <meta name="google" content="notranslate">
        

        



        
        <link href="https://www.guxingke.com/style.css" rel="stylesheet"/>
        
        <title>
    å…”å­æ´ä¸‹-é«˜æ€§èƒ½æ­ç§˜(Down the Rabbit Hole) - 
</title>
    </head>
    <body>
        <script>
            function evaluate_prefers_color() {
                if(localStorage.getItem('prefers-color') === 'dark') {
                    document.body.classList.add('dark');
                } else if(localStorage.getItem('prefers-color') === 'light') {
                    document.body.classList.remove('dark');
                } else if(window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.body.classList.add('dark');
                }
            }
            evaluate_prefers_color();
        </script>
        
    <main class="article-content">
        <p><a href="..">..</a>/down-the-rabbit-hole</p>
        
        <h1>å…”å­æ´ä¸‹-é«˜æ€§èƒ½æ­ç§˜(Down the Rabbit Hole)</h1>
        <p>Published: <time>2022-03-25</time></p>
        
            <div class="chips">
                
                    <span class="tag">HikariCP</span>
                
            </div>
        
        <hr />
        <p><a href="https://github.com/brettwooldridge/HikariCP/wiki/Down-the-Rabbit-Hole">åŸæ–‡é“¾æ¥-Down-the-Rabbit-Hole</a></p>
<blockquote>
<p>è¯‘è€…æ³¨: Brett Wooldridge edited this page on Apr 11, 2018 Â· 48 revisions<br />
åŸºäº deepL çš„ç¿»è¯‘ï¼Œåšäº†å¾®è°ƒã€‚</p>
</blockquote>
<hr />
<p>è¿™å°±æ˜¯æˆ‘ä»¬é€éœ²ç§˜æ–¹çš„åœ°æ–¹ã€‚å½“ä½ å¸¦ç€åƒæˆ‘ä»¬è¿™æ ·çš„åŸºå‡†æ¥çš„æ—¶å€™ï¼Œæœ‰ä¸€å®šé‡çš„æ€€ç–‘ä¸»ä¹‰å¿…é¡»è¢«è§£å†³ã€‚å¦‚æœä½ æƒ³åˆ°æ€§èƒ½å’Œè¿æ¥æ± ï¼Œä½ å¯èƒ½ä¼šè¢«è¯±æƒ‘ï¼Œè®¤ä¸ºè¿æ¥æ± æ˜¯æ€§èƒ½æ–¹ç¨‹ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ã€‚å…¶å®ä¸ç„¶ã€‚ä¸å…¶ä»–JDBCæ“ä½œç›¸æ¯”ï¼Œ<code>getConnection()</code> æ“ä½œçš„æ•°é‡å¾ˆå°‘ã€‚å¤§é‡çš„æ€§èƒ½æå‡æ¥è‡ªäºå¯¹åŒ…è£… <code>Connection</code>ã€<code>Statement</code> ç­‰çš„ &quot;delegates&quot; çš„ä¼˜åŒ–ã€‚</p>
<blockquote>
<p>è¯‘è€…æ³¨ï¼šåŸºå‡†æµ‹è¯•å‚é˜…<a href="https://github.com/brettwooldridge/HikariCP#checkered_flag-jmh-benchmarks">é¡¹ç›®åŸºå‡†æµ‹è¯•è¯´æ˜</a>ã€‚</p>
</blockquote>
<h2 id="brain-we-re-in-your-bytecodez">ğŸ§  We're in your bytecodez</h2>
<p>ä¸ºäº†ä½¿ <code>HikariCP</code> å˜å¾—å¦‚æ­¤ä¹‹å¿«ï¼Œæˆ‘ä»¬è¿›è¡Œäº†å­—èŠ‚ç çº§åˆ«çš„å·¥ç¨‹ï¼Œç”šè‡³æ›´å¤šã€‚æˆ‘ä»¬æ‹¿å‡ºäº†æˆ‘ä»¬æ‰€çŸ¥é“çš„æ‰€æœ‰æŠ€å·§æ¥å¸®åŠ© <code>JIT</code>ï¼Œå¸®åŠ©ä½ ã€‚æˆ‘ä»¬ç ”ç©¶äº†ç¼–è¯‘å™¨çš„å­—èŠ‚ç è¾“å‡ºï¼Œç”šè‡³æ˜¯ JIT çš„æ±‡ç¼–è¾“å‡ºï¼Œä»¥é™åˆ¶å…³é”®çš„ä¾‹ç¨‹å°äº JIT çš„ <code>inline-threshold</code>ã€‚æˆ‘ä»¬æ‰å¹³åŒ–äº†ç»§æ‰¿å±‚æ¬¡ï¼Œéšè—äº†æˆå‘˜å˜é‡ï¼Œæ¶ˆé™¤äº†è½¬æ¢ã€‚</p>
<blockquote>
<p>è¯‘è€…æ³¨ï¼š inline-threadhold æ˜¯å¤šå°‘ï¼Ÿ</p>
</blockquote>
<h2 id="microscope-micro-optimizations">ğŸ”¬ Micro-optimizations</h2>
<p>HikariCP åŒ…å«äº†è®¸å¤šå¾®è§‚çš„ä¼˜åŒ–ï¼Œè¿™äº›ä¼˜åŒ–å•ç‹¬æ¥çœ‹å‡ ä¹æ— æ³•è¡¡é‡ï¼Œä½†ç»“åˆèµ·æ¥å°±èƒ½æå‡æ•´ä½“æ€§èƒ½ã€‚å…¶ä¸­ä¸€äº›ä¼˜åŒ–æ˜¯ä»¥ä»¥é›¶ç‚¹å‡ æ¯«ç§’çš„æ—¶é—´æ¥è¡¡é‡ï¼Œå¹¶åœ¨æ•°ç™¾ä¸‡æ¬¡çš„è°ƒç”¨ä¸­æ‘Šé”€ã€‚</p>
<h3 id="arraylist">ArrayList</h3>
<p>ä¸€ä¸ªå¾®ä¸è¶³é“çš„ï¼ˆæ€§èƒ½ä¸Šçš„ï¼‰ä¼˜åŒ–æ˜¯åœ¨ <code>ConnectionProxy</code> ä¸­å–æ¶ˆä½¿ç”¨ <code>ArrayList&lt;Statement&gt;</code> å®ä¾‹ï¼Œç”¨äºè·Ÿè¸ªæ‰“å¼€çš„ <code>Statement</code> å®ä¾‹ã€‚å½“ä¸€ä¸ª <code>Statement</code> è¢«å…³é—­æ—¶ï¼Œå®ƒå¿…é¡»ä»è¿™ä¸ªé›†åˆä¸­åˆ é™¤ï¼Œå½“ <code>Connection</code> è¢«å…³é—­æ—¶ï¼Œå®ƒå¿…é¡»éå†è¿™ä¸ªé›†åˆå¹¶å…³é—­ä»»ä½•æ‰“å¼€çš„ <code>Statement</code> å®ä¾‹ï¼Œæœ€åå¿…é¡»æ¸…é™¤è¿™ä¸ªé›†åˆã€‚Java çš„ <code>ArrayList</code> åœ¨æ¯æ¬¡è°ƒç”¨ `get(int index)' æ—¶éƒ½ä¼šè¿›è¡ŒèŒƒå›´æ£€æŸ¥ï¼Œè¿™å¯¹äºä¸€èˆ¬ç”¨é€”æ¥è¯´æ˜¯æ˜æ™ºçš„ã€‚ç„¶è€Œï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ä¸ºæˆ‘ä»¬çš„èŒƒå›´æä¾›ä¿è¯ï¼Œè¿™ä¸ªæ£€æŸ¥åªæ˜¯å¼€é”€ã€‚</p>
<p>å¦å¤–ï¼Œ<code>remove(Object)</code> çš„å®ç°ä»å¤´åˆ°å°¾è¿›è¡Œæ‰«æï¼Œç„¶è€Œ JDBC ç¼–ç¨‹ä¸­å¸¸è§çš„æ¨¡å¼æ˜¯åœ¨ä½¿ç”¨åç«‹å³å…³é—­è¯­å¥ï¼Œæˆ–è€…æŒ‰ç…§æ‰“å¼€çš„ç›¸åé¡ºåºã€‚å¯¹äºè¿™äº›æƒ…å†µï¼Œä»å°¾éƒ¨å¼€å§‹çš„æ‰«æå°†è¡¨ç°å¾—æ›´å¥½ã€‚å› æ­¤ï¼Œ<code>ArrayList&lt;Statement&gt;</code> è¢«ä¸€ä¸ªè‡ªå®šä¹‰ç±» <code>FastList</code> æ‰€å–ä»£ï¼Œè¯¥ç±»æ¶ˆé™¤äº†èŒƒå›´æ£€æŸ¥ï¼Œä»å°¾éƒ¨åˆ°å¤´éƒ¨æ‰§è¡Œç§»é™¤æ‰«æã€‚</p>
<h3 id="concurrentbag">ConcurrentBag</h3>
<p>HikariCP åŒ…å«ä¸€ä¸ªè‡ªå®šä¹‰çš„æ— é”é›†åˆï¼Œç§°ä¸º <em>ConcurrentBag</em>ã€‚è¿™ä¸ªæƒ³æ³•å€Ÿé‰´äº† C# .NET çš„ ConcurrentBag ç±»ï¼Œä½†å†…éƒ¨å®ç°å®Œå…¨ä¸åŒã€‚ConcurrentBag æä¾›äº†...</p>
<ul>
<li>ä¸€ä¸ªæ— é”çš„è®¾è®¡</li>
<li>çº¿ç¨‹æœ¬åœ°ç¼“å­˜</li>
<li>çªƒå–é˜Ÿåˆ—</li>
<li>ç›´æ¥äº¤æ¥çš„ä¼˜åŒ–</li>
</ul>
<p>...å¯¼è‡´é«˜åº¦çš„å¹¶å‘æ€§ï¼Œæä½çš„å»¶è¿Ÿï¼Œä»¥åŠæœ€å°åŒ–çš„ <a href="http://en.wikipedia.org/wiki/False_sharing">false sharing</a> çš„å‘ç”Ÿã€‚</p>
<h3 id="diao-yong-invokevirtual-vs-invokestatic">è°ƒç”¨: <code>invokevirtual</code> vs <code>invokestatic</code></h3>
<p>ä¸ºäº†ç”Ÿæˆ <code>Connection</code>ã€<code>Statement</code> å’Œ <code>ResultSet</code> å®ä¾‹çš„ä»£ç†ï¼ŒHikariCP æœ€åˆä½¿ç”¨äº†ä¸€ä¸ªå•ä¾‹å·¥å‚ï¼Œåœ¨ <code>ConnectionProxy</code> çš„æƒ…å†µä¸‹ï¼Œè¢«ä¿å­˜åœ¨ä¸€ä¸ªé™æ€å­—æ®µï¼ˆPROXY_FACTORYï¼‰ã€‚</p>
<p>åœ¨ä»£ç åº“ä¸­å¤§æ¦‚åƒè¿™æ ·ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">public final </span><span style="color:#ebcb8b;">PreparedStatement </span><span style="color:#bf616a;">prepareStatement</span><span>(</span><span style="color:#ebcb8b;">String</span><span> sql, </span><span style="color:#ebcb8b;">String</span><span style="color:#b48ead;">[]</span><span> columnNames) throws </span><span style="color:#ebcb8b;">SQLException
</span><span>{
</span><span>    </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">PROXY_FACTORY</span><span>.</span><span style="color:#bf616a;">getProxyPreparedStatement</span><span>(</span><span style="color:#bf616a;">this</span><span>, delegate.</span><span style="color:#bf616a;">prepareStatement</span><span>(sql, columnNames));
</span><span>}
</span></code></pre>
<p>ä½¿ç”¨åŸå§‹çš„å•ä¾‹å·¥å‚ï¼Œç”Ÿæˆçš„å­—èŠ‚ç çœ‹èµ·æ¥åƒè¿™æ ·ã€‚</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span>    </span><span style="color:#bf616a;">public</span><span> final java.sql.PreparedStatement prepareStatement(java.lang.String, java.lang.String</span><span style="color:#b48ead;">[]</span><span>) </span><span style="color:#bf616a;">throws</span><span> java.sql.SQLException;
</span><span>    </span><span style="color:#bf616a;">flags:</span><span> ACC_PRIVATE, ACC_FINAL
</span><span>    </span><span style="color:#bf616a;">Code:
</span><span>      </span><span style="color:#bf616a;">stack</span><span>=</span><span style="color:#a3be8c;">5, </span><span style="color:#bf616a;">locals</span><span>=</span><span style="color:#a3be8c;">3, </span><span style="color:#bf616a;">args_size</span><span>=</span><span style="color:#a3be8c;">3
</span><span>         </span><span style="color:#bf616a;">0:</span><span> getstatic     </span><span style="color:#65737e;">#59                 // Field PROXY_FACTORY:Lcom/zaxxer/hikari/proxy/ProxyFactory;
</span><span>         </span><span style="color:#bf616a;">3:</span><span> aload_0
</span><span>         </span><span style="color:#bf616a;">4:</span><span> aload_0
</span><span>         </span><span style="color:#bf616a;">5:</span><span> getfield      </span><span style="color:#65737e;">#3                  // Field delegate:Ljava/sql/Connection;
</span><span>         </span><span style="color:#bf616a;">8:</span><span> aload_1
</span><span>         </span><span style="color:#bf616a;">9:</span><span> aload_2
</span><span>        </span><span style="color:#bf616a;">10:</span><span> invokeinterface </span><span style="color:#65737e;">#74,  3           // InterfaceMethod java/sql/Connection.prepareStatement:(Ljava/lang/String;[Ljava/lang/String;)Ljava/sql/PreparedStatement;
</span><span>        </span><span style="color:#bf616a;">15:</span><span> invokevirtual </span><span style="color:#65737e;">#69                 // Method com/zaxxer/hikari/proxy/ProxyFactory.getProxyPreparedStatement:(Lcom/zaxxer/hikari/proxy/ConnectionProxy;Ljava/sql/PreparedStatement;)Ljava/sql/PreparedStatement;
</span><span>        </span><span style="color:#bf616a;">18:</span><span> return
</span></code></pre>
<p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œé¦–å…ˆæœ‰ä¸€ä¸ª <code>getstatic</code> è°ƒç”¨ï¼Œä»¥è·å¾—é™æ€å­—æ®µ <code>PROXY_FACTORY</code> çš„å€¼ï¼Œä»¥åŠï¼ˆæœ€åï¼‰å¯¹ <code>ProxyFactory</code> å®ä¾‹çš„ <code>getProxyPreparedStatement()</code> çš„ <code>invokevirtual</code> è°ƒç”¨ã€‚</p>
<p>æˆ‘ä»¬å–æ¶ˆäº†å•ä¾‹å·¥å‚ï¼ˆç”± Javassist ç”Ÿæˆï¼‰ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä¸€ä¸ªå…·æœ‰ <code>static</code> æ–¹æ³•çš„<code>final</code> ç±»ï¼ˆå…¶ä¸»ä½“ç”± Javassist ç”Ÿæˆï¼‰ã€‚Java ä»£ç å˜æˆäº†ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span>    </span><span style="color:#b48ead;">public final </span><span style="color:#ebcb8b;">PreparedStatement </span><span style="color:#bf616a;">prepareStatement</span><span>(</span><span style="color:#ebcb8b;">String</span><span> sql, </span><span style="color:#ebcb8b;">String</span><span style="color:#b48ead;">[]</span><span> columnNames) throws </span><span style="color:#ebcb8b;">SQLException
</span><span>    {
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">ProxyFactory</span><span>.</span><span style="color:#bf616a;">getProxyPreparedStatement</span><span>(</span><span style="color:#bf616a;">this</span><span>, delegate.</span><span style="color:#bf616a;">prepareStatement</span><span>(sql, columnNames));
</span><span>    }
</span></code></pre>
<p>å…¶ä¸­ <code>getProxyPreparedStatement()</code> æ˜¯ <code>ProxyFactory</code> ç±»ä¸­å®šä¹‰çš„ä¸€ä¸ª <code>static</code> æ–¹æ³•ã€‚ç”±æ­¤äº§ç”Ÿçš„å­—èŠ‚ç æ˜¯ï¼š</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span>    </span><span style="color:#bf616a;">private</span><span> final java.sql.PreparedStatement prepareStatement(java.lang.String, java.lang.String</span><span style="color:#b48ead;">[]</span><span>) </span><span style="color:#bf616a;">throws</span><span> java.sql.SQLException;
</span><span>    </span><span style="color:#bf616a;">flags:</span><span> ACC_PRIVATE, ACC_FINAL
</span><span>    </span><span style="color:#bf616a;">Code:
</span><span>      </span><span style="color:#bf616a;">stack</span><span>=</span><span style="color:#a3be8c;">4, </span><span style="color:#bf616a;">locals</span><span>=</span><span style="color:#a3be8c;">3, </span><span style="color:#bf616a;">args_size</span><span>=</span><span style="color:#a3be8c;">3
</span><span>         </span><span style="color:#bf616a;">0:</span><span> aload_0
</span><span>         </span><span style="color:#bf616a;">1:</span><span> aload_0
</span><span>         </span><span style="color:#bf616a;">2:</span><span> getfield      </span><span style="color:#65737e;">#3                  // Field delegate:Ljava/sql/Connection;
</span><span>         </span><span style="color:#bf616a;">5:</span><span> aload_1
</span><span>         </span><span style="color:#bf616a;">6:</span><span> aload_2
</span><span>         </span><span style="color:#bf616a;">7:</span><span> invokeinterface </span><span style="color:#65737e;">#72,  3           // InterfaceMethod java/sql/Connection.prepareStatement:(Ljava/lang/String;[Ljava/lang/String;)Ljava/sql/PreparedStatement;
</span><span>        </span><span style="color:#bf616a;">12:</span><span> invokestatic  </span><span style="color:#65737e;">#67                 // Method com/zaxxer/hikari/proxy/ProxyFactory.getProxyPreparedStatement:(Lcom/zaxxer/hikari/proxy/ConnectionProxy;Ljava/sql/PreparedStatement;)Ljava/sql/PreparedStatement;
</span><span>        </span><span style="color:#bf616a;">15:</span><span> areturn
</span></code></pre>
<p>è¿™é‡Œæœ‰ä¸‰ä»¶äº‹å€¼å¾—æ³¨æ„ã€‚</p>
<ul>
<li><code>getstatic</code> è°ƒç”¨æ²¡æœ‰äº†ã€‚</li>
<li><code>invokevirtual</code> è°ƒç”¨è¢«æ›¿æ¢ä¸º <code>invokestatic</code> è°ƒç”¨ï¼Œæ›´å®¹æ˜“è¢« JVM ä¼˜åŒ–ã€‚</li>
<li>æœ€åï¼Œç¬¬ä¸€çœ¼å¯èƒ½æ²¡æœ‰æ³¨æ„åˆ°çš„æ˜¯ï¼Œå †æ ˆå¤§å°ä» 5 ä¸ªå…ƒç´ å‡å°‘åˆ° 4 ä¸ªå…ƒç´ ã€‚è¿™æ˜¯å› ä¸ºåœ¨<code>invokevirtual</code> çš„æƒ…å†µä¸‹ï¼ŒProxyFactory çš„å®ä¾‹è¢«éšå«åœ°ä¼ é€’åˆ°å †æ ˆä¸­ï¼ˆå³<code>this</code>ï¼‰ï¼Œå½“ <code>getProxyPreparedStatement()</code> è¢«è°ƒç”¨æ—¶ï¼Œè¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„ï¼ˆçœ‹ä¸è§çš„ï¼‰ä»å †æ ˆä¸­å–å‡ºçš„å€¼ã€‚
æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªå˜åŒ–æ¶ˆé™¤äº†ä¸€ä¸ªé™æ€å­—æ®µè®¿é—®ï¼Œä»å †æ ˆä¸­æ¨é€å’Œå¼¹å‡ºï¼Œå¹¶ä½¿è°ƒç”¨æ›´å®¹æ˜“è¢« JIT ä¼˜åŒ–ï¼Œå› ä¸ºè°ƒç”¨ç‚¹è¢«ä¿è¯ä¸ä¼šæ”¹å˜ã€‚</li>
</ul>
<hr />
<h2 id="tu-yeah-but-still"><code>Â¯\_(ãƒ„)_/Â¯</code> Yeah, but still...</h2>
<p>åœ¨æˆ‘ä»¬çš„åŸºå‡†ä¸­ï¼Œæˆ‘ä»¬æ˜¾ç„¶æ˜¯é’ˆå¯¹ä¸€ä¸ª <code>stub JDBC</code> é©±åŠ¨å®ç°è¿è¡Œçš„ï¼Œæ‰€ä»¥ JIT åšäº†å¤§é‡çš„å†…è”ã€‚ç„¶è€Œï¼ŒåŒæ ·çš„å†…è”åœ¨å­˜æ ¹çº§å‘ç”Ÿåœ¨åŸºå‡†çš„å…¶ä»–æ± ä¸Šã€‚å› æ­¤ï¼Œå¯¹æˆ‘ä»¬æ¥è¯´æ²¡æœ‰å›ºæœ‰çš„ä¼˜åŠ¿ã€‚</p>
<p>ä½†æ˜¯ï¼Œå³ä½¿æ˜¯åœ¨ä½¿ç”¨çœŸæ­£çš„é©±åŠ¨ç¨‹åºæ—¶ï¼Œå†…è”ä¹Ÿè‚¯å®šæ˜¯ä¸€ä¸ªé‡è¦çš„éƒ¨åˆ†ï¼Œè¿™å°±æŠŠæˆ‘ä»¬å¸¦åˆ°äº†å¦ä¸€ä¸ªè¯é¢˜......</p>
<h3 id="scheduler-quanta">Scheduler quanta</h3>
<p>Some <a href="https://www.cs.uic.edu/%7Ejbell/CourseNotes/OperatingSystems/5_CPU_Scheduling.html">light reading</a>.</p>
<p><strong>TL;DR</strong> å½“ä½ <strong>åŒæ—¶</strong>è¿è¡Œ 400 ä¸ªçº¿ç¨‹æ—¶ï¼Œä½ å¹¶æ²¡æœ‰çœŸæ­£<strong>åŒæ—¶</strong>è¿è¡Œå®ƒä»¬ï¼Œé™¤éä½ æœ‰ 400 ä¸ªå†…æ ¸ã€‚æ“ä½œç³»ç»Ÿä½¿ç”¨ N ä¸ª CPU æ ¸å¿ƒï¼Œåœ¨ä½ çš„çº¿ç¨‹ä¹‹é—´è¿›è¡Œåˆ‡æ¢ï¼Œç»™æ¯ä¸ªçº¿ç¨‹ä¸€å°å— &quot;ç‰‡&quot; çš„æ—¶é—´æ¥è¿è¡Œï¼Œç§°ä¸º <code>quantum</code>ã€‚</p>
<p>åœ¨å¾ˆå¤šåº”ç”¨ç¨‹åºä¸­ï¼Œæœ‰å¾ˆå¤šçº¿ç¨‹åœ¨è¿è¡Œï¼Œå½“ä½ çš„æ—¶é—´ç‰‡ç”¨å®Œæ—¶ï¼ˆä½œä¸ºä¸€ä¸ªçº¿ç¨‹ï¼‰ï¼Œåœ¨è°ƒåº¦å™¨ç»™ä½ ä¸€ä¸ªæœºä¼šå†æ¬¡è¿è¡Œä¹‹å‰ï¼Œå¯èƒ½ä¼šæœ‰ &quot;å¾ˆé•¿ä¸€æ®µæ—¶é—´&quot;ã€‚å› æ­¤ï¼Œè‡³å…³é‡è¦çš„æ˜¯ï¼Œä¸€ä¸ªçº¿ç¨‹è¦åœ¨å…¶æ—¶é—´ç‰‡å†…å°½å¯èƒ½å¤šåœ°å®Œæˆå·¥ä½œï¼Œå¹¶é¿å…é”è¿«ä½¿å®ƒæ”¾å¼ƒè¯¥æ—¶é—´ç‰‡ï¼Œå¦åˆ™å°±è¦ä»˜å‡ºæ€§èƒ½ä¸Šçš„ä»£ä»·ã€‚è€Œä¸”ä¸æ˜¯ä¸€ä¸ªå°æ•°ç›®ã€‚</p>
<p>è¿™ç»™æˆ‘ä»¬å¸¦æ¥äº†...</p>
<h3 id="snail-cpu-huan-cun-xing-shi-xiao">ğŸŒ CPU ç¼“å­˜è¡Œå¤±æ•ˆ</h3>
<p>å½“ä½ ä¸èƒ½åœ¨ä¸€ä¸ª <code>quanta</code> å†…å®Œæˆå·¥ä½œæ—¶ï¼Œå¦ä¸€ä¸ªå¾ˆå¤§çš„æ‰“å‡»æ˜¯ CPU ç¼“å­˜è¡Œçš„å¤±æ•ˆã€‚å¦‚æœä½ çš„çº¿ç¨‹è¢«è°ƒåº¦æŠ¢å äº†ï¼Œå½“å®ƒæœ‰æœºä¼šå†æ¬¡è¿è¡Œæ—¶ï¼Œå®ƒç»å¸¸è®¿é—®çš„æ‰€æœ‰æ•°æ®å¾ˆå¯èƒ½å·²ç»ä¸åœ¨æ ¸å¿ƒçš„ L1 æˆ–æ ¸å¿ƒå¯¹ L2 ç¼“å­˜ä¸­äº†ã€‚æ›´æœ‰å¯èƒ½çš„æ˜¯ï¼Œä½ æ— æ³•æ§åˆ¶ä¸‹ä¸€ä¸ªè¢«è°ƒåº¦åˆ°å“ªä¸ªæ ¸ä¸Šã€‚</p>
<hr />
<h2 id="bei-zhu">å¤‡æ³¨</h2>
<p>æœ¬èŠ‚å†…å®¹ä¸ºè¡¥å……å†…å®¹ï¼ŒéåŸæ–‡ç¿»è¯‘ã€‚</p>
<p>HikariCP wiki é‡Œè¿˜æœ‰ä¸¤ç¯‡å†…å®¹å€¼å¾—ä¸€çœ‹ã€‚</p>
<ul>
<li>
<p><a href="https://github.com/brettwooldridge/HikariCP/wiki/%22My-benchmark-doesn&#x27;t-show-a-difference.%22">My benchmark doesn't show a difference</a><br />
å†…å®¹ä¸»è¦è¯´æ˜å…¶ä»–è¿æ¥æ± åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯æ€§èƒ½ä¼˜å…ˆä¸å¯é æ€§ï¼Œåœ¨é…ç½®ä¸ºå¯é çš„æƒ…å†µä¸‹ï¼Œæ€§èƒ½å¤§å¹…åº¦ä¸‹é™ï¼Œè€Œ HikariCP æ˜¯åœ¨å¯é æ€§ä¼˜å…ˆçš„å‰æä¸‹å–å¾—äº†é«˜æ€§èƒ½ã€‚</p>
</li>
<li>
<p><a href="https://github.com/brettwooldridge/HikariCP/wiki/About-Pool-Sizing">About Pool Sizing</a><br />
å¦‚ä½•åˆç†çš„é…ç½®çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± è¶Šå¤§è¶Šå¥½å—ï¼Ÿ</p>
</li>
</ul>
<h3 id="xiang-guan-lian-jie">ç›¸å…³é“¾æ¥</h3>
<ul>
<li><a href="https://github.com/brettwooldridge/HikariCP/wiki/Down-the-Rabbit-Hole">åŸæ–‡é“¾æ¥</a></li>
<li><a href="https://github.com/brettwooldridge/HikariCP">HikariCP</a></li>
<li><a href="https://github.com/brettwooldridge/HikariCP-benchmark">HikariCP-benchmark</a></li>
</ul>

    </main>

        <footer>
            <hr text="&copy; Copyright 2022" />
            
            <div class="footer-social-media">
                <a onclick="toggle_prefers_color()">Toggle Theme</a>
                
                    <a href="https://github.com/guxingke" target="_blank">GitHub</a>
                
                    <a href="https://twitter.com/@guxingke" target="_blank">Twitter</a>
                
            </div>
            
        </footer>
    </body>

    
        <script src="https://www.guxingke.com/js/script.js"/></script>
    
</html>